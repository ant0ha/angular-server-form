!function(r,e){"use strict";e.module("angular-server-form",[]).provider("serverForm",[function(){var r=this;r.errorsKey="errors",r.logging=!0,r.$get=["$http","$q","$log",function(n,o,t){function i(r,e){(r.$render||r.$setViewValue)&&r.$setValidity("server",!1),r.$setPristine(),r.$server=e}var s=this;return s.serialize=function(r){function e(r){var n={};for(var o in r)r.hasOwnProperty(o)&&"$"!==o[0]&&(n[o]=r[o].hasOwnProperty("$modelValue")?r[o].$modelValue:e(r[o]));return n}var n={};return r.$name?n[r.$name]=e(r):n=e(r),n},s.applyErrors=function(n,o){if(e.isString(o))i(n,o);else if(e.isArray(o))i(n,o.join(", "));else for(var a in o)o.hasOwnProperty(a)&&(n.hasOwnProperty(a)?s.applyErrors(n[a],o[a]):n.$name===a?s.applyErrors(n,o[a]):r.logging&&t.warn("No place to render property",a,"in form",n))},s.clearErrors=function a(r){(r.$render||r.$setViewValue)&&r.$setValidity("server",!0),r.$setPristine(),r.$server="";for(var e in r)r.hasOwnProperty(e)&&"$"!==e[0]&&a(r[e])},s.submit=function(e,o){return s.clearErrors(e),e.$submitting=!0,e.$saved=!1,n(o).success(function(){e.$saved=!0}).error(function(n,o){e.$saved=!1,422===o&&(r.errorsKey?s.applyErrors(e,n[r.errorsKey]):s.applyErrors(e,n))}).finally(function(){e.$submitting=!1})},s}]}]).directive("serverForm",["serverForm",function(r){return{restrict:"A",scope:{url:"@",method:"@",onSuccess:"=",onError:"="},require:"form",link:function(e,n,o,t){function i(n){if(!t.$submitting){var o={url:e.url,method:e.method?e.method:"POST",data:r.serialize(t)};r.submit(t,o).then(e.onSuccess,e.onError)}n.preventDefault(),e.$apply()}n.on("submit",i),e.$on("destroy",function(){n.off("submit",i)})}}}])}(window,window.angular);